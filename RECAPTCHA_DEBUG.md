# reCAPTCHA Debug Guide - –û—à–∏–±–∫–∞ "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"

## –ü—Ä–æ–±–ª–µ–º–∞
```
400 (Bad Request) –Ω–∞ /api/uz/contact/:1
Error: –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.
```

## –ü—Ä–∏—á–∏–Ω—ã

### 1. **Low reCAPTCHA Score** (—Å–∞–º–∞—è –≤–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞)
Google reCAPTCHA v3 –≤—ã–¥–∞–µ—Ç score –æ—Ç 0 –¥–æ 1.0:
- **1.0** - —Ç–æ—á–Ω–æ —á–µ–ª–æ–≤–µ–∫
- **0.5** - –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ
- **0.0** - —Ç–æ—á–Ω–æ –±–æ—Ç

–ï—Å–ª–∏ score < `RECAPTCHA_SCORE_THRESHOLD` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.5), —Ñ–æ—Ä–º–∞ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è.

### 2. –ß—Ç–æ –º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å score:
- ü§ñ –ë—ã—Å—Ç—Ä—ã–µ –∫–ª–∏–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è)
- üåç VPN / Proxy / Tor
- üì± –ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- üîÑ –ë—ã—Å—Ç—Ä–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP
- üéØ –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–µ–µ –Ω–∞ –±–æ—Ç–∞

## –†–µ—à–µ–Ω–∏–µ

### ‚úÖ –£–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–°–Ω–∏–∑–∏–ª–∏ –ø–æ—Ä–æ–≥ –≤ `/main/utils/recaptcha.py`:**
   - –ë—ã–ª–æ: `threshold = settings.RECAPTCHA_SCORE_THRESHOLD` (0.5)
   - –°—Ç–∞–ª–æ: `threshold = getattr(settings, 'RECAPTCHA_SCORE_THRESHOLD', 0.3)`
   - –¢–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ–º score >= 0.3 –≤–º–µ—Å—Ç–æ >= 0.5

2. **–î–æ–±–∞–≤–∏–ª–∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
   - –í–∏–¥–Ω–æ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ score –≤ –ª–æ–≥–∞—Ö
   - –§–æ—Ä–º–∞—Ç: `üîç reCAPTCHA Score Check: {score} >= {threshold}`

### üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:

```bash
# –ù–∞ production —Å–µ—Ä–≤–µ—Ä–µ:
tail -f logs/django.log | grep "reCAPTCHA"

# –ò–ª–∏ –≤ Django admin:
# –ó–∞–π—Ç–∏ –≤ Django admin -> Logs (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
```

### ‚öôÔ∏è –î–∞–ª—å–Ω–µ–π—à–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è):

#### –í–∞—Ä–∏–∞–Ω—Ç A: –°–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥ –µ—â–µ –±–æ–ª—å—à–µ
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª:
```env
RECAPTCHA_SCORE_THRESHOLD=0.2
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –û—Ç–∫–ª—é—á–∏—Ç—å reCAPTCHA –Ω–∞ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:
```env
RECAPTCHA_ENABLED=False
```
‚ö†Ô∏è **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!**

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–í–º–µ—Å—Ç–æ score-based –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å action-based:
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ recaptcha.py:
if result.get('action') != action:
    return {'success': False, 'error': 'Action mismatch'}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –¥–ª—è —É—Å–ø–µ—Ö–∞:
```
‚úÖ reCAPTCHA passed: score=0.85
```

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –¥–ª—è –æ—à–∏–±–∫–∏:
```
üö´ reCAPTCHA failed for contact form: score=0.2, error=Suspicious activity detected (score: 0.2)
```

## –§–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

1. `/main/utils/recaptcha.py` - —Å–Ω–∏–∂–µ–Ω –ø–æ—Ä–æ–≥, –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
2. `/main/views.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ score –≤–æ –≤—Å–µ 3 ViewSet'–∞:
   - `ContactFormViewSet`
   - `JobApplicationViewSet`
   - `BecomeADealerApplicationViewSet`

## –í–æ–∑–º–æ–∂–Ω—ã–µ –±—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤ —ç—Ç–æ–º –ø–æ—Ä—è–¥–∫–µ:

1. **–ß–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞** (—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
2. **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ VPN** (—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
3. **–°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞ –¥–æ 0.2**
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ CSRF —Ç–æ–∫–µ–Ω–∞** –≤ headers
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ IP –∞–¥—Ä–µ—Å–∞** –≤ –ª–æ–≥–∞—Ö (–º–æ–∂–µ—Ç –±—ã—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω Google)
